<div class="container-fluid py-4">
    <div class="card">
      <div class="card-header bg-primary text-white">
        <h5 class="mb-0">Cadastro de Paciente</h5>
      </div>
      <div class="card-body">
        <form [formGroup]="pacienteForm" (ngSubmit)="onSubmit()">
          
          <!-- Dados pessoais -->
          <div class="row mb-4">
            <div class="col-12">
              <h6 class="border-bottom pb-2 mb-3">Dados Pessoais</h6>
            </div>
            
            <div class="col-md-6 mb-3">
              <label for="nome_completo" class="form-label">Nome Completo</label>
              <input type="text" class="form-control" id="nome_completo" formControlName="nome_completo" 
                    [ngClass]="{'is-invalid': isFieldValid('nome_completo')}">
              <div class="invalid-feedback">Nome completo é obrigatório.</div>
            </div>
            
            <div class="col-md-3 mb-3">
              <label for="cpf" class="form-label">CPF</label>
              <input type="text" class="form-control" id="cpf" formControlName="cpf" 
                    [ngClass]="{'is-invalid': isFieldValid('cpf')}">
              <div class="invalid-feedback">CPF válido é obrigatório (11 dígitos).</div>
            </div>
            
            <div class="col-md-3 mb-3">
              <label for="data_nascimento" class="form-label">Data de Nascimento</label>
              <input type="date" class="form-control" id="data_nascimento" formControlName="data_nascimento"
                    [ngClass]="{'is-invalid': isFieldValid('data_nascimento')}">
              <div class="invalid-feedback">Data de nascimento é obrigatória.</div>
            </div>
            
            <div class="col-md-3 mb-3">
              <label for="genero" class="form-label">Gênero</label>
              <select class="form-select" id="genero" formControlName="genero">
                <option value="" selected>Selecione...</option>
                <option *ngFor="let genero of generos" [value]="genero">{{ genero }}</option>
              </select>
            </div>
            
            <div class="col-md-3 mb-3">
              <label for="estado_civil" class="form-label">Estado Civil</label>
              <select class="form-select" id="estado_civil" formControlName="estado_civil">
                <option value="" selected>Selecione...</option>
                <option *ngFor="let estadoCivil of estadosCivis" [value]="estadoCivil">{{ estadoCivil }}</option>
              </select>
            </div>
            
            <div class="col-md-3 mb-3">
              <label for="profissao" class="form-label">Profissão</label>
              <input type="text" class="form-control" id="profissao" formControlName="profissao">
            </div>
            
            <div class="col-md-3 mb-3">
              <label for="nacionalidade" class="form-label">Nacionalidade</label>
              <input type="text" class="form-control" id="nacionalidade" formControlName="nacionalidade">
            </div>

            <div class="col-md-3 mb-3">
              <label for="status" class="form-label">Status do Paciente</label>
              <select class="form-select" id="status" formControlName="status" [ngClass]="{'is-invalid': isFieldValid('status')}">
                <option value="" selected>Selecione...</option>
                <option *ngFor="let status of statusPaciente" [value]="status">{{ status }}</option>
              </select>
              <div class="invalid-feedback">O status do paciente é obrigatório.</div>
            </div>
          </div>
          
          <!-- Contato -->
          <div class="row mb-4">
            <div class="col-12">
              <h6 class="border-bottom pb-2 mb-3">Informações de Contato</h6>
            </div>
            
            <div class="col-md-4 mb-3">
              <label for="telefone" class="form-label">Telefone Principal</label>
              <input type="tel" class="form-control" id="telefone" formControlName="telefone"
                    [ngClass]="{'is-invalid': isFieldValid('telefone')}">
              <div class="invalid-feedback">Telefone principal é obrigatório.</div>
            </div>
            
            <div class="col-md-4 mb-3">
              <label for="telefone_secundario" class="form-label">Telefone Secundário</label>
              <input type="tel" class="form-control" id="telefone_secundario" formControlName="telefone_secundario">
            </div>
            
            <div class="col-md-4 mb-3">
              <label for="email" class="form-label">E-mail</label>
              <input type="email" class="form-control" id="email" formControlName="email"
                    [ngClass]="{'is-invalid': isFieldValid('email')}">
              <div class="invalid-feedback">E-mail inválido.</div>
            </div>
          </div>
          
          <!-- Endereço -->
          <div class="row mb-4" formGroupName="endereco">
            <div class="col-12">
              <h6 class="border-bottom pb-2 mb-3">Endereço</h6>
            </div>
            
            <div class="col-md-3 mb-3">
              <label for="cep" class="form-label">CEP</label>
              <input type="text" class="form-control" id="cep" formControlName="cep"
                    (blur)="onCepChange()" [ngClass]="{'is-invalid': isEnderecoFieldValid('cep')}">
              <div class="invalid-feedback">CEP é obrigatório.</div>
            </div>
            
            <div class="col-md-6 mb-3">
              <label for="logradouro" class="form-label">Logradouro</label>
              <input type="text" class="form-control" id="logradouro" formControlName="logradouro"
                    [ngClass]="{'is-invalid': isEnderecoFieldValid('logradouro')}">
              <div class="invalid-feedback">Logradouro é obrigatório.</div>
            </div>
            
            <div class="col-md-3 mb-3">
              <label for="numero" class="form-label">Número</label>
              <input type="text" class="form-control" id="numero" formControlName="numero"
                    [ngClass]="{'is-invalid': isEnderecoFieldValid('numero')}">
              <div class="invalid-feedback">Número é obrigatório.</div>
            </div>
            
            <div class="col-md-4 mb-3">
              <label for="complemento" class="form-label">Complemento</label>
              <input type="text" class="form-control" id="complemento" formControlName="complemento">
            </div>
            
            <div class="col-md-4 mb-3">
              <label for="bairro" class="form-label">Bairro</label>
              <input type="text" class="form-control" id="bairro" formControlName="bairro"
                    [ngClass]="{'is-invalid': isEnderecoFieldValid('bairro')}">
              <div class="invalid-feedback">Bairro é obrigatório.</div>
            </div>
            
            <div class="col-md-4 mb-3">
              <label for="cidade" class="form-label">Cidade</label>
              <input type="text" class="form-control" id="cidade" formControlName="cidade"
                    [ngClass]="{'is-invalid': isEnderecoFieldValid('cidade')}">
              <div class="invalid-feedback">Cidade é obrigatória.</div>
            </div>
            
            <div class="col-md-4 mb-3">
              <label for="estado" class="form-label">Estado</label>
              <input type="text" class="form-control" id="estado" formControlName="estado"
                    [ngClass]="{'is-invalid': isEnderecoFieldValid('estado')}">
              <div class="invalid-feedback">Estado é obrigatório.</div>
            </div>
          </div>
          
          <!-- Informações médicas -->
          <div class="row mb-4">
            <div class="col-12">
              <h6 class="border-bottom pb-2 mb-3">Informações Médicas</h6>
            </div>
            
            <div class="col-md-3 mb-3">
              <label for="cid_primario" class="form-label">CID Primário</label>
              <input type="text" class="form-control" id="cid_primario" formControlName="cid_primario"
                    [ngClass]="{'is-invalid': isFieldValid('cid_primario')}">
              <div class="invalid-feedback">CID primário é obrigatório.</div>
            </div>
            
            <div class="col-md-3 mb-3">
              <label for="cid_secundario" class="form-label">CID Secundário</label>
              <input type="text" class="form-control" id="cid_secundario" formControlName="cid_secundario">
            </div>
            
            <div class="col-md-3 mb-3">
              <label for="acomodacao" class="form-label">Acomodação</label>
              <select class="form-select" id="acomodacao" formControlName="acomodacao"
                     [ngClass]="{'is-invalid': isFieldValid('acomodacao')}">
                <option value="" selected>Selecione...</option>
                <option *ngFor="let acomodacao of acomodacoes" [value]="acomodacao">{{ acomodacao }}</option>
              </select>
              <div class="invalid-feedback">Acomodação é obrigatória.</div>
            </div>
            
            <div class="col-md-3 mb-3">
              <label for="medico_responsavel" class="form-label">Médico Responsável</label>
              <input type="text" class="form-control" id="medico_responsavel" formControlName="medico_responsavel">
            </div>
            
            <div class="col-12 mb-3">
              <label for="alergias" class="form-label">Alergias</label>
              <textarea class="form-control" id="alergias" rows="3" formControlName="alergias"></textarea>
            </div>
          </div>
          
          <!-- Convênio e plano -->
          <div class="row mb-4">
            <div class="col-12">
              <h6 class="border-bottom pb-2 mb-3">Convênio e Plano</h6>
            </div>
            
            <div class="col-md-3 mb-3">
              <div class="form-group">
                <label for="convenio_id">Convênio</label>
                <select id="convenio_id" formControlName="convenio_id" class="form-control" (change)="onConvenioChange($event)">
                  <option [value]="null">Selecione um convênio</option>
                  <option *ngFor="let convenio of convenios" [value]="convenio.id">
                    {{ convenio.nome }}
                  </option>
                </select>
              </div>
            </div>
            
            <div class="col-md-3 mb-3">
              <div class="form-group">
                <label for="plano_id">Plano</label>
                <select id="plano_id" formControlName="plano_id" class="form-control">
                  <option [value]="null">Selecione um plano</option>
                  <option *ngFor="let plano of planosFiltrados" [value]="plano.id">
                    {{ plano.nome }}
                  </option>
                </select>
              </div>
            </div>
            
            <div class="col-md-3 mb-3">
              <label for="numero_carteirinha" class="form-label">Número da Carteirinha</label>
              <input type="text" class="form-control" id="numero_carteirinha" formControlName="numero_carteirinha">
            </div>
            
            <div class="col-md-3 mb-3">
              <label for="data_validade" class="form-label">Data de Validade</label>
              <input type="date" class="form-control" id="data_validade" formControlName="data_validade">
            </div>
          </div>
          
          <!-- Contato de Emergência -->
          <div class="row mb-4">
            <div class="col-12">
              <h6 class="border-bottom pb-2 mb-3">Contato de Emergência</h6>
            </div>
            
            <div class="col-md-4 mb-3">
              <label for="contato_emergencia" class="form-label">Nome do Contato</label>
              <input type="text" class="form-control" id="contato_emergencia" formControlName="contato_emergencia">
            </div>
            
            <div class="col-md-4 mb-3">
              <label for="telefone_emergencia" class="form-label">Telefone de Emergência</label>
              <input type="tel" class="form-control" id="telefone_emergencia" formControlName="telefone_emergencia">
            </div>
            
            <div class="col-md-4 mb-3">
              <label for="case_responsavel" class="form-label">Case Responsável</label>
              <input type="text" class="form-control" id="case_responsavel" formControlName="case_responsavel">
            </div>
          </div>
          
          <!-- Botões -->
          <div class="d-flex justify-content-between mt-4">
            <button type="button" class="btn btn-secondary" (click)="limparFormulario()">
              <i class="bi bi-eraser me-2"></i>Limpar
            </button>
            <div>
              <button type="button" class="btn btn-outline-primary me-2" routerLink="/pacientes">
                <i class="bi bi-arrow-left me-2"></i>Voltar
              </button>
              <button type="submit" class="btn btn-primary">
                <i class="bi bi-person-plus-fill me-2"></i>Cadastrar Paciente
              </button>
            </div>
          </div>
        </form>
      </div>
    </div>
  </div>